# Настройка STP

## Исходные данные:

#### Addressing Table

| Device  | Interface          |IP Address   |Subnet Mask  |
| -------:|------------------:| -------------:| -----------:| 
| S1      | VLAN 1             | 192.168.1.1  |255.255.255.0|
| S2      | VLAN 1             | 192.168.1.2 |255.255.255.0| 
| S3      | VLAN 1             | 192.168.1.3 |255.255.255.0| 

## Задачи:

#### Часть 1: Создание сети и настройка основных параметров устройства
#### Часть 2: Выбор корневого моста
#### Часть 3: Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов
#### Часть 4: Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов

## Топология:

#### Cхема лабораторного стенда, выполненная в draw.io:

![Image alt](https://github.com/Misha-cook/otus-networks/blob/main/labs/lab02/%D0%A0%D0%B8%D1%81%D1%83%D0%BD%D0%BE%D0%BA_1.png)

#### Cхема лабораторного стенда, выполненная в Packet Tracer:

![Image alt](https://github.com/Misha-cook/otus-networks/blob/main/labs/lab02/%D0%A0%D0%B8%D1%81%D1%83%D0%BD%D0%BE%D0%BA_2.png)

## Выполнение задания:

#### [Часть 1: Создание сети и настройка основных параметров устройства.](#основные-настройки-произведенные-на-s1) 
#### [Часть 2: Выбор корневого моста](#алгоритм-выбора) 
#### Часть 3: Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов
#### Часть 4: Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов

## Выполнение задания:

### Часть 1: Создание сети и настройка основных параметров устройства.

##### Основные настройки произведенные на S1 

```
(Команды выполнены в конфигурационном режиме)
hostname S1                              // переименуем коммутатор
!
no ip domain-lookup                      // отключите поиск DNS
!
enable secret ******                     // поставим пароль на вход в режим enable
!
line vty 0 15                            // подключения по виртуальному интерфейсу(16)
!
login                                    // отвечает за возможность аутентификации
!
password cisco                           // устанавливаем  пароль для удаленного входа на коммутатор
!
banner motd #Unauthorized access to this device is prohibited! // установка баннера
!
interface Vlan1                          // конфигурация управляющего интерфейса
!
ip address 192.168.1.1 255.255.255.0

Выходим из конфигурационного режима

clock set 13:12:00 23 october 2018      // установка времени
!
copy running-config startup-config      //сохранение конфигурации

```
##### Проверка связности

ping с S1 на S2

![Image alt](https://github.com/Misha-cook/otus-networks/blob/main/labs/lab02/%D0%A0%D0%B8%D1%81%D1%83%D0%BD%D0%BE%D0%BA_3.png).

ping с S1 на S3

![Image alt](https://github.com/Misha-cook/otus-networks/blob/main/labs/lab02/%D0%A0%D0%B8%D1%81%D1%83%D0%BD%D0%BE%D0%BA_4.png).

ping с S2 на S3

![Image alt](https://github.com/Misha-cook/otus-networks/blob/main/labs/lab02/%D0%A0%D0%B8%D1%81%D1%83%D0%BD%D0%BE%D0%BA_5.png).

### Часть 2: Выбор корневого моста

##### Алгоритм выбора 

В качестве корня дерева выбирается коммутатор с наименьшим значением идентификатора моста. 
Идентификатор моста — это 8-байтное поле, которое состоит из 2-х частей: 
- приоритета моста (2 байта), назначаемого администратором сети **по умолчанию приоритет равен 32768**
- МАС-адреса блока управления коммутатора (6 байт).

Корневым мостом становится коммутатор с наименьшим значением приоритета.

в данной лабораторной корневым стал S1 т.к у него наименьший MAC-адрес

![Image alt](https://github.com/Misha-cook/otus-networks/blob/main/labs/lab02/%D0%A0%D0%B8%D1%81%D1%83%D0%BD%D0%BE%D0%BA_6.1.png)

##### Выбор корневого порта

Стоимость пути рассчитывается как суммарное условное время на передачу данных от порта данного коммутатора до порта корневого моста.
Стоимости пути по умолчанию для каждого канала определены в стандарте IEEE 802.1W-2001.

| Скорость передачи  |  Стоимость (802.1D-1998)| Стоимость (802.1W-2001)|
| ---------:|---------------------:| ------------------:|
|10 Мбит/с  | 	10                 | 2 000 000          |
|100 Мбит/с | 	19                 | 200 000            |   
|1 Гбит/с   | 	4                  | 20 000             |
|10 Гбит/с  | 	2                  | 2 000              | 

Сравнив стоимости всех возможных маршрутов до корня, каждый коммутатор выбирает среди них один с наименьшим значением стоимости. Порт, соединяющий коммутатор с этим маршрутом, становится корневым портом. В случае если минимальные стоимости пути нескольких маршрутов окажутся одинаковыми, корневым портом станет порт, имеющий наименьшее значение идентификатора порта

⦁	Отключите все порты на коммутаторах.

```
interface range fastEthernet 0/1-24               //отключение портов на коммутаторах
```

Cхема лабораторного стенда, после выполненная действия:

![Image alt](https://github.com/Misha-cook/otus-networks/blob/main/labs/lab02/%D0%A0%D0%B8%D1%81%D1%83%D0%BD%D0%BE%D0%BA_9.png)

⦁	Настройте подключенные порты в качестве транковых.
```
switchport mode trunk                               //подключения портов на коммутаторах в качестве транковых
```
⦁	Включите порты F0/2 и F0/4 на всех коммутаторах.

⦁	Отобразите данные протокола spanning-tree.

Cхема лабораторного стенда, после выполненная действия:

![Image alt](https://github.com/Misha-cook/otus-networks/blob/main/labs/lab02/%D0%A0%D0%B8%D1%81%D1%83%D0%BD%D0%BE%D0%BA_13.png)

В данной лабораторной корневым стал S1 т.к у него наименьший MAC-адрес

![Image alt](https://github.com/Misha-cook/otus-networks/blob/main/labs/lab02/%D0%A0%D0%B8%D1%81%D1%83%D0%BD%D0%BE%D0%BA_10.png)

Состояние S2

![Image alt](https://github.com/Misha-cook/otus-networks/blob/main/labs/lab02/%D0%A0%D0%B8%D1%81%D1%83%D0%BD%D0%BE%D0%BA_11.png)

Состояние портов:

Root port (корневой порт) — это порт, который имеет минимальную стоимость до любого порта корневого коммутатора;
Designated port (назначенный порт) — это порт, который имеет кратчайшее расстояние от назначенного коммутатора до корневого коммутатора.В данном случае он не заблокирован так как S2 имеет меньший MAC по сравнению с S3

Состояние S3

![Image alt](https://github.com/Misha-cook/otus-networks/blob/main/labs/lab02/%D0%A0%D0%B8%D1%81%D1%83%D0%BD%D0%BE%D0%BA_12.png)
 
Состояние портов:

Alternate port — альтернативный путь к корневому коммутатору. Путь отличается от того, который использует корневой порт (в пересылке кадров не учавствует).

### Часть 3: Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов

⦁	Измените стоимость порта.

Изменение стоимости заблокированного порта на S3 в меньшую сторону, заблокированным станет Fa0/2 S2. По причине того, что корневая стоимость через Fa0/4 коммутатора S3 будет меньше и он станет назнеченным, а Fa0/2 S2, соответственно заблокированным.

![Image alt](https://github.com/Misha-cook/otus-networks/blob/main/labs/lab02/%D0%A0%D0%B8%D1%81%D1%83%D0%BD%D0%BE%D0%BA_14.png)

Состояние STP на S3

![Image alt](https://github.com/Misha-cook/otus-networks/blob/main/labs/lab02/%D0%A0%D0%B8%D1%81%D1%83%D0%BD%D0%BE%D0%BA_15.png)


### [в начало](#настройка-stp)
